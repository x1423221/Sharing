"use strict";(self["webpackChunksplit"]=self["webpackChunksplit"]||[]).push([[305],{3409:function(e,l,a){a.d(l,{A:function(){return d}});var t=a(7617),u=a(3405),n="firebase",o="11.1.0";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(0,u.KO)(n,o,"app");const s={apiKey:void 0,authDomain:"vuetest-35344.firebaseapp.com",projectId:"vuetest-35344",storageBucket:"vuetest-35344.firebasestorage.app",messagingSenderId:"2844207119",appId:"1:2844207119:web:687837aeece2bf9eea5b7a",measurementId:"G-42LZ3K97KN"},i=(0,u.Wp)(s),r=(0,t.aU)(i);var d=r},6777:function(e,l,a){a.d(l,{A:function(){return d}});a(4114);var t=a(6768),u=a(144),n=a(1387),o=a(7477),s={__name:"BtnGotoHomePage",setup(e){const l=(0,n.rd)(),a=()=>{l.push("/")};return(e,l)=>{const n=(0,t.g2)("el-button");return(0,t.uX)(),(0,t.CE)("div",null,[(0,t.bF)(n,{type:"danger",size:"small",icon:(0,u.R1)(o.bm),circle:"",onClick:a},null,8,["icon"])])}}},i=a(1241);const r=(0,i.A)(s,[["__scopeId","data-v-70e41686"]]);var d=r},9305:function(e,l,a){a.r(l),a.d(l,{default:function(){return W}});a(4114),a(8992),a(4520),a(2577),a(3949),a(1454),a(8872),a(7550);var t=a(6768),u=a(144),n=a(4232),o=a(880),s=a(3409),i=a(6777),r=a(7617);const d={class:"dialog-footer"},c="140px";var p={__name:"PaymentComponents",props:{dialogFormVisible:{default:!1},dialogFormVisibleModifiers:{},DocId:{},DocIdModifiers:{},dialogpayment:{},dialogpaymentModifiers:{}},emits:["update:dialogFormVisible","update:DocId","update:dialogpayment"],setup(e){const l=(0,u.KR)(null),a=(0,t.WQ)("MemberList"),n=(0,t.WQ)("profile"),o=(0,t.fn)(e,"dialogFormVisible"),i=(0,t.fn)(e,"DocId"),p=(0,t.fn)(e,"dialogpayment"),m=async e=>{const l=(0,r.H9)(s.A,"transactionList",i.value);if(e){const e=p.value.split.filter((e=>e.userName!==p.value.payer)).reduce(((e,l)=>Number(e)+Number(l.share)),0)>p.value.amount;if(e)return void alert("明細總金額 超過 帳目總金額");await(0,r.mZ)(l,{[`${p.value.id}.description`]:p.value.description,[`${p.value.id}.amount`]:Number(p.value.amount),[`${p.value.id}.split`]:p.value.split})}await(0,r.mZ)(l,{[`${p.value.id}.isLock`]:!1}),o.value=!1},v=()=>{p.value.split.push({share:Number(0),userId:n.value.userId,userName:n.value.displayName}),(0,t.dY)((()=>{l.value&&(l.value.wrapRef.scrollTop=l.value.wrapRef.scrollHeight)}))},b=e=>{const l=a.value.find((l=>l.userId===p.value.split[e].userId));p.value.split[e].userName=l.name};return(e,n)=>{const s=(0,t.g2)("el-divider"),i=(0,t.g2)("el-input"),r=(0,t.g2)("el-form-item"),f=(0,t.g2)("el-option"),y=(0,t.g2)("el-select"),k=(0,t.g2)("el-col"),h=(0,t.g2)("el-row"),g=(0,t.g2)("el-scrollbar"),F=(0,t.g2)("el-form"),_=(0,t.g2)("el-button"),I=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.Wv)(I,{modelValue:o.value,"onUpdate:modelValue":n[4]||(n[4]=e=>o.value=e),"destroy-on-close":"","show-close":!1,width:"80%","lock-scroll":!1,"close-on-click-modal":!1},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",d,[(0,t.bF)(_,{type:"danger",onClick:n[2]||(n[2]=e=>m(!1))},{default:(0,t.k6)((()=>n[7]||(n[7]=[(0,t.eW)("關閉")]))),_:1}),(0,t.bF)(_,{type:"primary",onClick:n[3]||(n[3]=e=>m(!0))},{default:(0,t.k6)((()=>n[8]||(n[8]=[(0,t.eW)(" 儲存 ")]))),_:1}),(0,t.bF)(_,{type:"success",onClick:v},{default:(0,t.k6)((()=>n[9]||(n[9]=[(0,t.eW)("新增")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.bF)(F,{model:p.value},{default:(0,t.k6)((()=>[(0,t.bF)(s,{"content-position":"left"},{default:(0,t.k6)((()=>n[5]||(n[5]=[(0,t.eW)("帳目維護")]))),_:1}),(0,t.bF)(r,{label:"帳目名稱","label-width":c},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:p.value.description,"onUpdate:modelValue":n[0]||(n[0]=e=>p.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),(0,t.bF)(r,{label:"帳目總金額","label-width":c},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:p.value.amount,"onUpdate:modelValue":n[1]||(n[1]=e=>p.value.amount=e),inputmode:"decimal"},null,8,["modelValue"])])),_:1}),(0,t.bF)(s,{"content-position":"left"},{default:(0,t.k6)((()=>n[6]||(n[6]=[(0,t.eW)("分攤明細")]))),_:1}),(0,t.bF)(g,{ref_key:"ShareArea",ref:l,height:"300px"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(p.value.split,((e,l)=>((0,t.uX)(),(0,t.Wv)(h,{gutter:3,key:l},{default:(0,t.k6)((()=>[(0,t.bF)(k,{span:7},{default:(0,t.k6)((()=>[(0,t.bF)(y,{modelValue:p.value.split[l].userId,"onUpdate:modelValue":e=>p.value.split[l].userId=e,onChange:e=>b(l)},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,u.R1)(a).value,(e=>((0,t.uX)(),(0,t.Wv)(f,{key:e.userId,label:e.name,value:e.userId},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:2},1024),(0,t.bF)(k,{span:17},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:p.value.split[l].share,"onUpdate:modelValue":e=>p.value.split[l].share=e,inputmode:"decimal",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)))),128))])),_:1},512)])),_:1},8,["model"])])),_:1},8,["modelValue"])}}},m=a(1241);const v=(0,m.A)(p,[["__scopeId","data-v-7e2cda8c"]]);var b=v,f=a(7477),y=a(9648);const k={class:"title-container"},h={key:0},g={key:1},F={class:"card-header"},_={key:0},I={key:0},w={key:0},C={key:1},A={key:0};var N={__name:"GroupComponents",setup(e){const l=(0,t.WQ)("profile"),a=(0,t.WQ)("isLoading"),d=(0,t.WQ)("currentGroup"),c=(0,t.WQ)("MemberList"),p=(0,u.KR)(!1),m=(0,u.KR)([]),v=(0,u.KR)([]),N=(0,u.KR)([]),V=(0,u.KR)(""),W=(0,u.KR)(""),x=(0,u.Kh)({}),L=(0,u.Kh)({}),K=(0,u.KR)(!1);(0,t.sV)((async()=>{try{a.value=!0,W.value=d.value.name,V.value=d.value.id,d&&Q(V.value)}catch(e){alert(e)}finally{a.value=!1}})),(0,t.wB)(m,((e,l)=>{if(l.length>0){const a=e.filter((e=>!l.some((l=>l.id===e.id))));(0,y.iN)(a,x,L)}else(0,y.iN)(e,x,L)}));const R=()=>{p.value=!p.value},X=async()=>{try{a.value=!0,d.value.name=W.value;const e=(0,r.H9)(s.A,"241229Test",d.value.did);await(0,r.mZ)(e,{[`${d.value.id}.name`]:d.value.name}),p.value=!p.value,a.value=!1}catch(e){alert(e)}},E=async()=>{a.value=!0;const e=crypto.randomUUID(),t=new y.ZX(l.value.userId,l.value.displayName,0,l.value.displayName+"創建",new Date).toMap();try{const l=(0,r.H9)(s.A,"transactionList",d.value.id),u=await(0,r.x7)(l);u.exists()?await(0,r.mZ)(l,{[`${e}`]:t}):await(0,r.BN)(l,{[`${e}`]:t}),a.value=!1}catch(u){alert(u)}},D=async()=>{try{const e=crypto.randomUUID(),l="https://liff.line.me/2006768109-93myxPab/",a=`${l}?s=${e}`;await o.A.shareTargetPicker([{type:"flex",altText:"你收到一則分帳群組邀請！",contents:{type:"bubble",body:{type:"box",layout:"vertical",spacing:"md",contents:[{type:"text",text:"💰 分帳群組邀請",weight:"bold",size:"xl",color:"#1DB446"},{type:"text",text:"群組名稱："+W.value,wrap:!0,weight:"bold",size:"md",color:"#333333"},{type:"text",text:"📅 建立日期："+d.value.date,size:"sm",color:"#666666"},{type:"text",text:"📌記錄每一筆支出，讓分帳變得更輕鬆！",size:"sm",color:"#999999",wrap:!0}]},footer:{type:"box",layout:"vertical",spacing:"sm",contents:[{type:"button",style:"primary",color:"#1DB446",action:{type:"uri",label:"加入群組",uri:a}}]}}}],{isMultiple:!0}).then((async()=>{const l=(0,r.H9)(s.A,"TokenList",e);await(0,r.BN)(l,{date:new Date,docId:d.value.did,fid:d.value.id})}))}catch(e){alert(e)}},U=()=>{let e=[],l=v.value.map((e=>({userName:e.userName,netAmount:e.splitAmount}))),a=l.filter((e=>e.netAmount<0)),t=l.filter((e=>e.netAmount>0)),u=[];while(a.length>0&&t.length>0){let e=a[0],l=t[0],n=Math.min(Math.abs(e.netAmount),l.netAmount);u.push({from:e.userName,to:l.userName,amount:n}),e.netAmount+=n,l.netAmount-=n,0===e.netAmount&&a.shift(),0===l.netAmount&&t.shift()}return e=u,e},Q=async e=>{const l=(0,r.H9)(s.A,"transactionList",e),a=(0,r.H9)(s.A,"241229Test",d.value.did),u=(0,r.aQ)(a,(e=>{if(e.exists()){const l=e.data()[d.value.id];d.value.members=l.members,c.value=l.members}})),n=(0,r.aQ)(l,(e=>{if(m.value=[],v.value=[],N.value=[],e.exists()){const l=e.data(),a=Object.entries(l).map((([e,l])=>({id:e,...l})));m.value=a,m.value.forEach((e=>{let l=0;if(e.split){e.split.forEach((a=>{const t=a.userId,u=a.userName,n=-1*parseFloat(a.share);if(t!=e.userId){l+=n;let e=v.value.find((e=>e.userId===t));e?e.splitAmount+=n:v.value.push(new y._l(t,u,n))}}));let a=v.value.find((l=>l.userId==e.userId));a?a.splitAmount+=-1*l:v.value.push(new y._l(e.userId,e.payer,-1*l))}})),N.value=U(),N.value.sort(((e,l)=>l.amount-e.amount)),m.value.sort(((e,l)=>new Date(l.date)-new Date(e.date))),v.value.sort(((e,l)=>e.splitAmount-l.splitAmount))}else m.value=[],v.value=[]}));(0,t.hi)((()=>{u(),n()}))},$=(0,t.EW)((()=>{const e=m.value.map((e=>Object.values(e.split.filter((l=>l.userName!==e.payer)).reduce(((e,l)=>(e[l.userId]?e[l.userId].share+=Number(l.share):e[l.userId]={userName:l.userName,userId:l.userId,share:Number(l.share)},e)),{}))));return e})),H=(0,u.KR)({}),M=async e=>{try{const l=(0,r.H9)(s.A,"transactionList",V.value);a.value=!0,await(0,r.mZ)(l,{[`${e.id}.isLock`]:!0}),H.value=e,K.value=!0,a.value=!1}catch(l){alert(l)}};return(e,l)=>{const a=(0,t.g2)("el-button"),o=(0,t.g2)("el-input"),s=(0,t.g2)("el-header"),r=(0,t.g2)("el-divider"),c=(0,t.g2)("el-table-column"),v=(0,t.g2)("el-table"),y=(0,t.g2)("el-card"),U=(0,t.g2)("el-scrollbar"),Q=(0,t.g2)("el-main"),z=(0,t.g2)("el-footer"),B=(0,t.g2)("el-container");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.bF)(b,{dialogFormVisible:K.value,"onUpdate:dialogFormVisible":l[0]||(l[0]=e=>K.value=e),dialogpayment:H.value,"onUpdate:dialogpayment":l[1]||(l[1]=e=>H.value=e),DocId:V.value,"onUpdate:DocId":l[2]||(l[2]=e=>V.value=e)},null,8,["dialogFormVisible","dialogpayment","DocId"]),(0,t.bF)(B,null,{default:(0,t.k6)((()=>[(0,t.bF)(s,null,{default:(0,t.k6)((()=>[(0,t.Lk)("div",k,[(0,t.bF)(i.A),(0,u.R1)(d)&&!p.value?((0,t.uX)(),(0,t.CE)("div",h,[(0,t.Lk)("span",null,(0,n.v_)((0,u.R1)(d).value.name),1),(0,t.bF)(a,{type:"success",icon:(0,u.R1)(f.ffu),size:"small",circle:"",onClick:R},null,8,["icon"])])):(0,t.Q3)("",!0),(0,u.R1)(d)&&p.value?((0,t.uX)(),(0,t.CE)("div",g,[(0,t.bF)(o,{type:"text",style:{width:"100px"},modelValue:W.value,"onUpdate:modelValue":l[3]||(l[3]=e=>W.value=e)},null,8,["modelValue"]),(0,t.bF)(a,{type:"success",icon:(0,u.R1)(f.Jlk),size:"small",circle:"",onClick:X},null,8,["icon"]),(0,t.bF)(a,{type:"danger",icon:(0,u.R1)(f.bm),size:"small",circle:"",onClick:R},null,8,["icon"])])):(0,t.Q3)("",!0)])])),_:1}),(0,t.bF)(Q,null,{default:(0,t.k6)((()=>[(0,t.bF)(r,{"content-position":"left"},{default:(0,t.k6)((()=>l[4]||(l[4]=[(0,t.eW)(" 建議付款方案 ")]))),_:1}),(0,t.bF)(v,{data:N.value,height:"30%"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{prop:"from",label:"付款人"}),(0,t.bF)(c,{prop:"to",label:"收款人"}),(0,t.bF)(c,{prop:"amount",label:"應付金額"})])),_:1},8,["data"]),(0,t.bF)(r,{"content-position":"left"},{default:(0,t.k6)((()=>l[5]||(l[5]=[(0,t.eW)(" 帳目列表 ")]))),_:1}),(0,t.bF)(U,{height:"55%","wrap-style":"overflow-x: hidden;"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(m.value,((e,u)=>((0,t.uX)(),(0,t.Wv)(y,{key:u,class:(0,n.C4)({hidden:L[e.id]}),style:(0,n.Tr)(x[e.id])},{header:(0,t.k6)((()=>[(0,t.Lk)("div",F,[(0,t.Lk)("span",null,(0,n.v_)(e.description),1)])])),footer:(0,t.k6)((()=>[e.isLock?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",A,[(0,t.bF)(a,{type:"primary",onClick:l=>M(e)},{default:(0,t.k6)((()=>l[8]||(l[8]=[(0,t.eW)(" 編輯 ")]))),_:2},1032,["onClick"])]))])),default:(0,t.k6)((()=>[e.split?((0,t.uX)(),(0,t.CE)("div",_,[(0,t.eW)(" 由"+(0,n.v_)(e.payer)+"先墊付金額:",1),(0,t.Lk)("span",null,(0,n.v_)(e.amount),1),(0,t.Lk)("p",null,(0,n.v_)(e.payer)+"支付"+(0,n.v_)(e.amount-e.split.filter((l=>l.userName!==e.payer)).reduce(((e,l)=>e+Number(l.share)),0)),1),e.split.length>0?((0,t.uX)(),(0,t.CE)("p",I,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)($.value[u],((e,a)=>((0,t.uX)(),(0,t.CE)("span",{key:e.userId},[(0,t.Lk)("span",null,(0,n.v_)(e.userName),1),l[7]||(l[7]=(0,t.eW)("應付")),(0,t.Lk)("span",null,(0,n.v_)(e.share),1),(a+1)%2===0?((0,t.uX)(),(0,t.CE)("span",w,l[6]||(l[6]=[(0,t.Lk)("br",null,null,-1)]))):a!==$.value[u].length-1?((0,t.uX)(),(0,t.CE)("span",C,", ")):(0,t.Q3)("",!0)])))),128))])):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0)])),_:2},1032,["class","style"])))),128))])),_:1})])),_:1}),(0,t.bF)(z,null,{default:(0,t.k6)((()=>[(0,t.bF)(a,{type:"success",onClick:D},{default:(0,t.k6)((()=>l[9]||(l[9]=[(0,t.eW)("分享")]))),_:1}),(0,t.bF)(a,{type:"success",onClick:E},{default:(0,t.k6)((()=>l[10]||(l[10]=[(0,t.eW)("新增帳目")]))),_:1})])),_:1})])),_:1})],64)}}};const V=(0,m.A)(N,[["__scopeId","data-v-027ca35c"]]);var W=V}}]);
//# sourceMappingURL=305.5a29629a.js.map