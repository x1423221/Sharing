{"version":3,"file":"js/658.292e3ab4.js","mappings":"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","sources":["webpack://split/../../index.ts","webpack://split/./src/firebase/config.js","webpack://split/./src/components/HomeComponents.vue","webpack://split/./src/components/HomeComponents.vue?ad8f"],"sourcesContent":["/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { registerVersion } from '@firebase/app';\nimport { name, version } from '../package.json';\n\nregisterVersion(name, version, 'app');\nexport * from '@firebase/app';\n","// Import the functions you need from the SDKs you need\r\n\r\nimport { getFirestore } from \"firebase/firestore\";\r\nimport { initializeApp } from \"firebase/app\";\r\n\r\n// TODO: Add SDKs for Firebase products that you want to use\r\n// https://firebase.google.com/docs/web/setup#available-libraries\r\n\r\n// Your web app's Firebase configuration\r\n// For Firebase JS SDK v7.20.0 and later, measurementId is optional\r\nconst firebaseConfig = {\r\n  apiKey: import.meta.FIREBASEKEY,\r\n  authDomain: \"vuetest-35344.firebaseapp.com\",\r\n  projectId: \"vuetest-35344\",\r\n  storageBucket: \"vuetest-35344.firebasestorage.app\",\r\n  messagingSenderId: \"2844207119\",\r\n  appId: \"1:2844207119:web:687837aeece2bf9eea5b7a\",\r\n  measurementId: \"G-42LZ3K97KN\"\r\n};\r\n\r\n// Initialize Firebase\r\nconst app = initializeApp(firebaseConfig);\r\nconst db = getFirestore(app);\r\nexport default db","<template>\r\n  <div class=\"home-container\">\r\n    <h1>分帳輕鬆搞定</h1>\r\n    <p>快速紀錄與分帳，讓金錢計算更簡單。</p>\r\n    <div>\r\n      <button id=\"btnCreateNew\" class=\"btn btn-success\" @click=\"gotoGroupPage\">\r\n        建立新分帳\r\n      </button>\r\n      <button id=\"btnShowHis\" class=\"btn btn-success\" @click=\"gotoHistoryPage\">\r\n        檢視歷史紀錄\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, inject } from \"vue\";\r\nimport { useRouter, useRoute } from \"vue-router\";\r\nimport {\r\n  doc,\r\n  setDoc,\r\n  getDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n  arrayUnion,\r\n} from \"firebase/firestore\";\r\nimport { SplitData, Member } from \"../Models/SplitModels\";\r\n\r\nimport db from \"../firebase/config\";\r\nimport liff from \"@line/liff\";\r\n\r\n//讀取旗標，用inject取得父元件定義的資料\r\nconst isLoading = inject(\"isLoading\");\r\n//LINE使用者資訊\r\nconst profile = inject(\"profile\");\r\n//分帳資料\r\nconst currentGroup = inject(\"currentGroup\");\r\n//分帳資料\r\nconst splitData = ref({});\r\n//route用於切換至Group或者History\r\nconst route = useRoute();\r\n//分享連結的Token\r\nconst sId = ref(null);\r\nconst router = useRouter();\r\n\r\n//Vue元件開始註冊時\r\nonMounted(async () => {\r\n  //設定讀取標籤為true，表示載入中，頁面反灰不可使用\r\n  isLoading.value = true;\r\n  //使用Liff方法取得目前登入使用者的資料\r\n  await liff.getProfile().then((value) => {\r\n    //設定取得的資料\r\n    profile.value = value;\r\n  });\r\n\r\n  //嘗試抓取進入網址的參數，如果有表示他是從分享連結進來的\r\n  sId.value = route.query.s;\r\n  if (sId.value) {\r\n    //根據傳進來的資料作處理\r\n    await HasPGotoGroupPage();\r\n  }\r\n\r\n  //解除讀取狀態\r\n  isLoading.value = false;\r\n});\r\n\r\n//如果是帶參數進入方式\r\nconst HasPGotoGroupPage = async () => {\r\n  try {\r\n    const tokenRef = doc(db, \"TokenList\", sId.value);\r\n    const tokenSnap = await getDoc(tokenRef);\r\n\r\n    if (tokenSnap.exists()) {\r\n      const data = tokenSnap.data();\r\n      const date = new Date(data.date.seconds * 1000); // 轉換為毫秒\r\n      const nowDate = new Date();\r\n      const tmpdate = new Date(date);\r\n      const fid = data.fid;\r\n      const docId = data.docId;\r\n\r\n      tmpdate.setDate(tmpdate.getDate() + 1);\r\n\r\n      if (nowDate > tmpdate) {\r\n        alert(\"連結已過期\");\r\n        await deleteDoc(tokenRef);\r\n        liff.closeWindow();\r\n      }\r\n\r\n      const docRef = doc(db, \"241229Test\", docId);\r\n      const docSnap = await getDoc(docRef);\r\n\r\n      if (docSnap.exists()) {\r\n        const fieldValue = docSnap.data()[fid];\r\n\r\n        const existsMember = fieldValue.members.find((record) => {\r\n          return record.userId === profile.value.userId;\r\n        });\r\n\r\n        if (!existsMember) {\r\n          try {\r\n            fieldValue.members.push(\r\n              new Member(profile.value.userId, profile.value.displayName)\r\n            );\r\n          } catch (err) {\r\n            alert(err);\r\n          }\r\n\r\n          try {\r\n            await updateDoc(docRef, {\r\n              [`${fid}.members`]: arrayUnion(\r\n                new Member(\r\n                  profile.value.userId,\r\n                  profile.value.displayName\r\n                ).topMap()\r\n              ),\r\n            })\r\n          } catch (err) {\r\n            alert(err)\r\n          }\r\n        }\r\n\r\n        await deleteDoc(tokenRef);\r\n        fieldValue.did = docId;\r\n        fieldValue.id = fid;\r\n        currentGroup.value = fieldValue;\r\n        router.push(\"/group\");\r\n      }\r\n    } else {\r\n      alert(\"連結已失效\");\r\n      liff.closeWindow();\r\n    }\r\n  } catch (err) {\r\n    alert(err);\r\n  }\r\n};\r\n\r\n//透過按鈕的方式進入Group\r\nconst gotoGroupPage = async () => {\r\n  isLoading.value = true;\r\n\r\n  try {\r\n    //讀取文件\r\n    const docRef = doc(db, \"241229Test\", profile.value.userId);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    //建立Guid\r\n    const RID = crypto.randomUUID();\r\n\r\n    //將member預設填入自己\r\n    const member = [];\r\n    member.push(\r\n      new Member(profile.value.userId, profile.value.displayName).topMap()\r\n    );\r\n\r\n    //建立分帳資料\r\n    splitData.value = new SplitData(\r\n      `${profile.value.displayName}的群組`,\r\n      member\r\n    );\r\n\r\n    //判斷是否已經有存在這個文件有的話是做更新\r\n    //應該可拿到建立新分帳就是新的阿XD\r\n    if (docSnap.exists()) {\r\n      await updateDoc(docRef, {\r\n        [`${RID}`]: splitData.value.toMap(),\r\n      });\r\n    }\r\n    //否則新增文件並新增群組\r\n    else {\r\n      await setDoc(docRef, {\r\n        [`${RID}`]: splitData.value.toMap(),\r\n      })\r\n        .then(() => console.log(\"Data saved successfully\"))\r\n        .catch((err) => console.error(\"Error saving data:\", err));\r\n    }\r\n\r\n    splitData.value = {\r\n      ...splitData.value,\r\n      id: RID,\r\n      did: profile.value.userId,\r\n    };\r\n    currentGroup.value = splitData.value;\r\n\r\n    //跳轉\r\n    router.push({ path: \"/group\" });\r\n  } catch (err) {\r\n    alert(err + \"新增資料失敗\");\r\n    isLoading.value = false;\r\n  }\r\n};\r\n\r\n//前往History頁面\r\nconst gotoHistoryPage = async () => {\r\n  isLoading.value = true;\r\n\r\n  router.push({ path: \"/history\" });\r\n};\r\n</script>\r\n\r\n<style scoped>\r\nh1,\r\nspan,\r\na,\r\np {\r\n  color: white;\r\n  margin: 0 0 10px 0;\r\n}\r\n\r\nbutton {\r\n  margin: 10px;\r\n}\r\n\r\n.home-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n#btnShowHis {\r\n  background: white;\r\n  border: white;\r\n  color: #2894ff;\r\n}\r\n\r\n#btnCreateNew {\r\n  background: #f75000;\r\n  border: white;\r\n  color: white;\r\n}\r\n\r\n@media screen and (max-width: 700px) {\r\n  .body {\r\n    display: block;\r\n    height: 100vh;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./HomeComponents.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./HomeComponents.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./HomeComponents.vue?vue&type=style&index=0&id=e48436c2&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-e48436c2\"]])\n\nexport default __exports__"],"names":["registerVersion","name","version","firebaseConfig","apiKey","import","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","app","initializeApp","db","getFirestore","isLoading","inject","profile","currentGroup","splitData","ref","route","useRoute","sId","router","useRouter","onMounted","async","value","liff","getProfile","then","query","s","HasPGotoGroupPage","tokenRef","doc","tokenSnap","getDoc","exists","data","date","Date","seconds","nowDate","tmpdate","fid","docId","setDate","getDate","alert","deleteDoc","closeWindow","docRef","docSnap","fieldValue","existsMember","members","find","record","userId","push","Member","displayName","err","updateDoc","arrayUnion","topMap","did","id","gotoGroupPage","RID","crypto","randomUUID","member","SplitData","toMap","setDoc","console","log","catch","error","path","gotoHistoryPage","__exports__"],"sourceRoot":""}